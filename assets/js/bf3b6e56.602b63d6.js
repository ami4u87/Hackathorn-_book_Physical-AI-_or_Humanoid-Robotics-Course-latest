"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[250],{884:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var r=s(4848),i=s(8453);const t={},c="Services",l={id:"module-1-ros2/services",title:"Services",description:"Services in ROS 2 provide a request-response communication pattern that is different from the publisher-subscriber model. In service-based communication, a service client sends a request to a service server, which processes the request and sends back a response. This is useful for operations that require immediate feedback or when you need to ensure that a specific task is completed before proceeding.",source:"@site/docs/module-1-ros2/3-services.md",sourceDirName:"module-1-ros2",slug:"/module-1-ros2/services",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/services",draft:!1,unlisted:!1,editUrl:"https://github.com/ami4u87/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/tree/master/docs/module-1-ros2/3-services.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"docsSidebar",previous:{title:"Publisher-Subscriber Pattern",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/pubsub"},next:{title:"Actions",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/actions"}},o={},a=[{value:"Understanding Services",id:"understanding-services",level:2},{value:"Creating a Service Definition",id:"creating-a-service-definition",level:2},{value:"Creating a Service Server",id:"creating-a-service-server",level:2},{value:"Python Service Server Example",id:"python-service-server-example",level:3},{value:"Creating a Service Client",id:"creating-a-service-client",level:2},{value:"Python Service Client Example",id:"python-service-client-example",level:3},{value:"Using Built-in Services",id:"using-built-in-services",level:2},{value:"Running the Service Example",id:"running-the-service-example",level:2},{value:"Service vs. Publisher-Subscriber",id:"service-vs-publisher-subscriber",level:2},{value:"Advanced Service Concepts",id:"advanced-service-concepts",level:2},{value:"Service Quality of Service (QoS)",id:"service-quality-of-service-qos",level:3},{value:"Service Error Handling",id:"service-error-handling",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"services",children:"Services"}),"\n",(0,r.jsx)(n.p,{children:"Services in ROS 2 provide a request-response communication pattern that is different from the publisher-subscriber model. In service-based communication, a service client sends a request to a service server, which processes the request and sends back a response. This is useful for operations that require immediate feedback or when you need to ensure that a specific task is completed before proceeding."}),"\n",(0,r.jsx)(n.h2,{id:"understanding-services",children:"Understanding Services"}),"\n",(0,r.jsx)(n.p,{children:"A service has two parts:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Request"}),": The data sent from the client to the server"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Response"}),": The data sent from the server back to the client"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Services are synchronous, meaning the client waits for the response before continuing execution. This makes them suitable for operations like:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Calculating a result based on input parameters"}),"\n",(0,r.jsx)(n.li,{children:"Triggering an action and waiting for completion confirmation"}),"\n",(0,r.jsx)(n.li,{children:"Retrieving specific information from a node"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"creating-a-service-definition",children:"Creating a Service Definition"}),"\n",(0,r.jsxs)(n.p,{children:["First, let's create a custom service definition. Create a file called ",(0,r.jsx)(n.code,{children:"AddTwoInts.srv"})," in a new package:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# In your workspace directory\nmkdir -p src/my_robot_msgs/srv\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create the service definition in ",(0,r.jsx)(n.code,{children:"src/my_robot_msgs/srv/AddTwoInts.srv"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"int64 a\nint64 b\n---\nint64 sum\n"})}),"\n",(0,r.jsx)(n.p,{children:"This service takes two integers as input and returns their sum."}),"\n",(0,r.jsx)(n.h2,{id:"creating-a-service-server",children:"Creating a Service Server"}),"\n",(0,r.jsx)(n.p,{children:"Let's create a service server that implements our custom service."}),"\n",(0,r.jsx)(n.h3,{id:"python-service-server-example",children:"Python Service Server Example"}),"\n",(0,r.jsx)(n.p,{children:"Create a new package for services:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python py_srv\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create the service server at ",(0,r.jsx)(n.code,{children:"src/py_srv/py_srv/service_member_function.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from add_two_ints_srv.srv import AddTwoInts\nimport rclpy\nfrom rclpy.node import Node\n\n\nclass MinimalService(Node):\n\n    def __init__(self):\n        super().__init__('minimal_service')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Incoming request\\na: {request.a}, b: {request.b}\\n')\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_service = MinimalService()\n\n    rclpy.spin(minimal_service)\n\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"creating-a-service-client",children:"Creating a Service Client"}),"\n",(0,r.jsx)(n.p,{children:"Now let's create a service client that sends requests to our service server."}),"\n",(0,r.jsx)(n.h3,{id:"python-service-client-example",children:"Python Service Client Example"}),"\n",(0,r.jsxs)(n.p,{children:["Create the client at ",(0,r.jsx)(n.code,{children:"src/py_srv/py_srv/client_member_function.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from add_two_ints_srv.srv import AddTwoInts\nimport rclpy\nfrom rclpy.node import Node\n\n\nclass MinimalClientAsync(Node):\n\n    def __init__(self):\n        super().__init__('minimal_client_async')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_client = MinimalClientAsync()\n    response = minimal_client.send_request(1, 2)\n    minimal_client.get_logger().info(\n        f'Result of add_two_ints: for {1} + {2} = {response.sum}')\n\n    minimal_client.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"using-built-in-services",children:"Using Built-in Services"}),"\n",(0,r.jsx)(n.p,{children:"ROS 2 also provides many built-in services. For example, you can use the parameter services to get and set parameters on a node:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# List services provided by a node\nros2 service list\n\n# Get information about a specific service\nros2 service info <service_name>\n\n# Call a service directly from the command line\nros2 service call /add_two_ints add_two_ints_srv/srv/AddTwoInts "{a: 1, b: 2}"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"running-the-service-example",children:"Running the Service Example"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"First, build your workspace (you may need to update the package.xml to include dependencies):"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select py_srv\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Source the workspace:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Run the service server in one terminal:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run py_srv service_member_function\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"In another terminal, run the client:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run py_srv client_member_function\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see the client send a request and receive a response from the server."}),"\n",(0,r.jsx)(n.h2,{id:"service-vs-publisher-subscriber",children:"Service vs. Publisher-Subscriber"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Feature"}),(0,r.jsx)(n.th,{children:"Publisher-Subscriber"}),(0,r.jsx)(n.th,{children:"Service"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Communication Pattern"}),(0,r.jsx)(n.td,{children:"Asynchronous"}),(0,r.jsx)(n.td,{children:"Synchronous"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Connection Type"}),(0,r.jsx)(n.td,{children:"Many-to-many"}),(0,r.jsx)(n.td,{children:"One-to-one"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Response Required"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Use Case"}),(0,r.jsx)(n.td,{children:"Continuous data streams"}),(0,r.jsx)(n.td,{children:"Request-response operations"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"advanced-service-concepts",children:"Advanced Service Concepts"}),"\n",(0,r.jsx)(n.h3,{id:"service-quality-of-service-qos",children:"Service Quality of Service (QoS)"}),"\n",(0,r.jsx)(n.p,{children:"Like topics, services also support QoS settings:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, QoSDurabilityPolicy\n\n# Create a QoS profile for services\nqos_profile = QoSProfile(depth=10)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"service-error-handling",children:"Service Error Handling"}),"\n",(0,r.jsx)(n.p,{children:"When calling services, it's important to handle potential errors:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def send_request_with_error_handling(self, a, b):\n    self.req.a = a\n    self.req.b = b\n\n    try:\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n\n        if self.future.result() is not None:\n            return self.future.result()\n        else:\n            self.get_logger().error('Service call failed')\n            return None\n    except Exception as e:\n        self.get_logger().error(f'Service call failed with exception: {e}')\n        return None\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use appropriate communication pattern"}),": Use services for operations that require a response, and topics for continuous data streams."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Handle service timeouts"}),": Always implement timeout handling for service calls to prevent indefinite blocking."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Design clear service interfaces"}),": Service requests and responses should be well-defined and intuitive."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Consider performance"}),": Services are synchronous, so long-running operations should be avoided or implemented asynchronously."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use built-in services when available"}),": ROS 2 provides many standard services that may meet your needs."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"Services provide a synchronous request-response communication pattern that complements the publisher-subscriber model. They are essential for operations that require immediate feedback or confirmation. Understanding when to use services versus topics is crucial for effective ROS 2 system design."}),"\n",(0,r.jsx)(n.p,{children:"In the next section, we'll explore actions, which provide a more sophisticated communication pattern for long-running tasks with feedback and goal management."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function c(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);