"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[727],{3824:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>r});var a=i(4848),t=i(8453);const c={},o="Actions",s={id:"module-1-ros2/actions",title:"Actions",description:"Actions in ROS 2 provide a communication pattern for long-running tasks that require feedback, goal management, and cancellation capabilities. Unlike services, which are synchronous and blocking, actions allow for asynchronous execution with continuous feedback. This makes them ideal for tasks like robot navigation, manipulation, or any operation that takes a significant amount of time to complete.",source:"@site/docs/module-1-ros2/4-actions.md",sourceDirName:"module-1-ros2",slug:"/module-1-ros2/actions",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/actions",draft:!1,unlisted:!1,editUrl:"https://github.com/ami4u87/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/tree/master/docs/module-1-ros2/4-actions.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"docsSidebar",previous:{title:"Services",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/services"},next:{title:"Parameters",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/parameters"}},l={},r=[{value:"Understanding Actions",id:"understanding-actions",level:2},{value:"Creating an Action Definition",id:"creating-an-action-definition",level:2},{value:"Creating an Action Server",id:"creating-an-action-server",level:2},{value:"Python Action Server Example",id:"python-action-server-example",level:3},{value:"Creating an Action Client",id:"creating-an-action-client",level:2},{value:"Python Action Client Example",id:"python-action-client-example",level:3},{value:"Running the Action Example",id:"running-the-action-example",level:2},{value:"Action States",id:"action-states",level:2},{value:"Using Built-in Actions",id:"using-built-in-actions",level:2},{value:"Advanced Action Concepts",id:"advanced-action-concepts",level:2},{value:"Goal Handling and Preemption",id:"goal-handling-and-preemption",level:3},{value:"Goal Validation",id:"goal-validation",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"actions",children:"Actions"}),"\n",(0,a.jsx)(n.p,{children:"Actions in ROS 2 provide a communication pattern for long-running tasks that require feedback, goal management, and cancellation capabilities. Unlike services, which are synchronous and blocking, actions allow for asynchronous execution with continuous feedback. This makes them ideal for tasks like robot navigation, manipulation, or any operation that takes a significant amount of time to complete."}),"\n",(0,a.jsx)(n.h2,{id:"understanding-actions",children:"Understanding Actions"}),"\n",(0,a.jsx)(n.p,{children:"Actions combine the concepts of services and topics to provide:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Goal"}),": The task to be performed"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Feedback"}),": Continuous updates on task progress"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Result"}),": The final outcome of the task"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Cancel"}),": Ability to cancel a running task"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Actions are perfect for operations like:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Moving a robot to a specific location"}),"\n",(0,a.jsx)(n.li,{children:"Manipulating an object with a robotic arm"}),"\n",(0,a.jsx)(n.li,{children:"Performing a complex calibration procedure"}),"\n",(0,a.jsx)(n.li,{children:"Running an extended data collection process"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"creating-an-action-definition",children:"Creating an Action Definition"}),"\n",(0,a.jsxs)(n.p,{children:["Let's create a custom action definition. Create a file called ",(0,a.jsx)(n.code,{children:"Fibonacci.action"})," in a new package:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# In your workspace directory\nmkdir -p src/my_robot_msgs/action\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Create the action definition in ",(0,a.jsx)(n.code,{children:"src/my_robot_msgs/action/Fibonacci.action"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"int32 order\n---\nint32[] sequence\n---\nint32[] partial_sequence\n"})}),"\n",(0,a.jsx)(n.p,{children:"This action takes an order (number of Fibonacci numbers to generate) and returns a sequence of Fibonacci numbers. The feedback is the partial sequence as it's being generated."}),"\n",(0,a.jsx)(n.h2,{id:"creating-an-action-server",children:"Creating an Action Server"}),"\n",(0,a.jsx)(n.p,{children:"Let's create an action server that implements our Fibonacci action."}),"\n",(0,a.jsx)(n.h3,{id:"python-action-server-example",children:"Python Action Server Example"}),"\n",(0,a.jsx)(n.p,{children:"Create a new package for actions:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python py_action\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Create the action server at ",(0,a.jsx)(n.code,{children:"src/py_action/py_action/action_server.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from py_action.action import Fibonacci\n\nimport rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\n\n\nclass FibonacciActionServer(Node):\n\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            self.execute_callback)\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        # Initialize the sequence with the first two Fibonacci numbers\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.partial_sequence = [0, 1]\n\n        # Publish initial feedback\n        goal_handle.publish_feedback(feedback_msg)\n\n        # Generate the Fibonacci sequence up to the requested order\n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.partial_sequence.append(\n                feedback_msg.partial_sequence[i] + feedback_msg.partial_sequence[i-1])\n\n            self.get_logger().info(f'Publishing feedback: {feedback_msg.partial_sequence}')\n            goal_handle.publish_feedback(feedback_msg)\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.partial_sequence\n        self.get_logger().info(f'Returning result: {result.sequence}')\n\n        return result\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    fibonacci_action_server = FibonacciActionServer()\n\n    rclpy.spin(fibonacci_action_server)\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"creating-an-action-client",children:"Creating an Action Client"}),"\n",(0,a.jsx)(n.p,{children:"Now let's create an action client that sends goals to our action server."}),"\n",(0,a.jsx)(n.h3,{id:"python-action-client-example",children:"Python Action Client Example"}),"\n",(0,a.jsxs)(n.p,{children:["Create the client at ",(0,a.jsx)(n.code,{children:"src/py_action/py_action/action_client.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from py_action.action import Fibonacci\n\nimport rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\n\n\nclass FibonacciActionClient(Node):\n\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(\n            self,\n            Fibonacci,\n            'fibonacci')\n\n    def send_goal(self, order):\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self._action_client.wait_for_server()\n\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback)\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected :(')\n            return\n\n        self.get_logger().info('Goal accepted :)')\n\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        self.get_logger().info(f'Received feedback: {feedback.partial_sequence}')\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: {result.sequence}')\n        rclpy.shutdown()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    action_client = FibonacciActionClient()\n\n    action_client.send_goal(10)\n\n    rclpy.spin(action_client)\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"running-the-action-example",children:"Running the Action Example"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"First, build your workspace:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select py_action\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Source the workspace:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Run the action server in one terminal:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"ros2 run py_action action_server\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsx)(n.li,{children:"In another terminal, run the client:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"ros2 run py_action action_client\n"})}),"\n",(0,a.jsx)(n.p,{children:"You should see the client send a goal, receive feedback during execution, and finally get the result."}),"\n",(0,a.jsx)(n.h2,{id:"action-states",children:"Action States"}),"\n",(0,a.jsx)(n.p,{children:"Actions can be in one of several states:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"PENDING"}),": The goal has been accepted but not yet started"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"ACTIVE"}),": The goal is currently being processed"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"RECALLING"}),": The goal is being recalled before execution"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"REJECTED"}),": The goal was rejected by the server"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"RECALLED"}),": The goal was successfully recalled"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"PREEMPTING"}),": The goal is being preempted by a new goal"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"PREEMPTED"}),": The goal was successfully preempted"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"SUCCEEDED"}),": The goal completed successfully"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"ABORTED"}),": The goal was aborted due to failure"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"using-built-in-actions",children:"Using Built-in Actions"}),"\n",(0,a.jsxs)(n.p,{children:["ROS 2 provides various built-in actions through packages like ",(0,a.jsx)(n.code,{children:"nav2_msgs"})," for navigation. You can also use command-line tools to interact with actions:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# List all available actions\nros2 action list\n\n# Get information about a specific action\nros2 action info <action_name>\n\n# Send a goal to an action\nros2 action send_goal <action_name> <action_type> <goal_values>\n"})}),"\n",(0,a.jsx)(n.h2,{id:"advanced-action-concepts",children:"Advanced Action Concepts"}),"\n",(0,a.jsx)(n.h3,{id:"goal-handling-and-preemption",children:"Goal Handling and Preemption"}),"\n",(0,a.jsx)(n.p,{children:"Action servers can handle multiple goals and implement preemption:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def execute_callback(self, goal_handle):\n    self.get_logger().info('Executing goal...')\n\n    # Check for preemption\n    while some_condition:\n        if goal_handle.is_cancel_requested:\n            goal_handle.canceled()\n            return Fibonacci.Result()\n\n        # Check if a new goal should preempt this one\n        if goal_handle.is_new_goal_available:\n            goal_handle.abort()\n            return Fibonacci.Result()\n\n        # Do work...\n\n    goal_handle.succeed()\n    return Fibonacci.Result()\n"})}),"\n",(0,a.jsx)(n.h3,{id:"goal-validation",children:"Goal Validation"}),"\n",(0,a.jsx)(n.p,{children:"Servers can validate goals before accepting them:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def execute_callback(self, goal_handle):\n    # Validate the goal\n    if goal_handle.request.order <= 0:\n        self.get_logger().info('Invalid order, rejecting goal')\n        goal_handle.abort()\n        return Fibonacci.Result()\n\n    # Accept and process the goal\n    # ... rest of the implementation\n"})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use appropriate communication pattern"}),": Use actions for long-running tasks that need feedback or cancellation, services for simple request-response, and topics for continuous data streams."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Provide meaningful feedback"}),": Feedback should give useful information about progress to the client."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Handle cancellation gracefully"}),": Always check for cancellation requests and clean up resources appropriately."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Set appropriate timeouts"}),": Configure timeouts for action clients to prevent indefinite waiting."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Design clear action interfaces"}),": Goals, feedback, and results should be well-defined and intuitive."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"Actions provide a sophisticated communication pattern for long-running tasks with feedback and cancellation capabilities. They are essential for operations like robot navigation, manipulation, and complex procedures that take time to complete. Understanding when to use actions versus services or topics is crucial for effective ROS 2 system design."}),"\n",(0,a.jsx)(n.p,{children:"In the next section, we'll explore parameters, which provide a way to configure nodes dynamically at runtime."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>s});var a=i(6540);const t={},c=a.createContext(t);function o(e){const n=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);