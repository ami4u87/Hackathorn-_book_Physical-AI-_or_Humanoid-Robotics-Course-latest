"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[622],{8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>c});var i=n(6540);const r={},l=i.createContext(r);function t(e){const s=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:s},e.children)}},9294:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>o});var i=n(4848),r=n(8453);const l={},t="Publisher-Subscriber Pattern",c={id:"module-1-ros2/pubsub",title:"Publisher-Subscriber Pattern",description:"The Publisher-Subscriber (Pub/Sub) pattern is one of the fundamental communication mechanisms in ROS 2. It enables asynchronous message passing between different nodes in a robotic system. Publishers send messages to topics, and subscribers receive messages from topics without needing to know about each other directly.",source:"@site/docs/module-1-ros2/2-pubsub.md",sourceDirName:"module-1-ros2",slug:"/module-1-ros2/pubsub",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/pubsub",draft:!1,unlisted:!1,editUrl:"https://github.com/ami4u87/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/tree/master/docs/module-1-ros2/2-pubsub.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"docsSidebar",previous:{title:"Installation",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/installation"},next:{title:"Services",permalink:"/Hackathorn-_book_Physical-AI-_or_Humanoid-Robotics-Course-latest/docs/module-1-ros2/services"}},a={},o=[{value:"Understanding Topics",id:"understanding-topics",level:2},{value:"Creating a Publisher Node",id:"creating-a-publisher-node",level:2},{value:"Python Publisher Example",id:"python-publisher-example",level:3},{value:"C++ Publisher Example",id:"c-publisher-example",level:3},{value:"Creating a Subscriber Node",id:"creating-a-subscriber-node",level:2},{value:"Python Subscriber Example",id:"python-subscriber-example",level:3},{value:"Running the Publisher and Subscriber",id:"running-the-publisher-and-subscriber",level:2},{value:"Understanding the Code",id:"understanding-the-code",level:2},{value:"Publisher Breakdown",id:"publisher-breakdown",level:3},{value:"Subscriber Breakdown",id:"subscriber-breakdown",level:3},{value:"Message Types",id:"message-types",level:2},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"publisher-subscriber-pattern",children:"Publisher-Subscriber Pattern"}),"\n",(0,i.jsx)(s.p,{children:"The Publisher-Subscriber (Pub/Sub) pattern is one of the fundamental communication mechanisms in ROS 2. It enables asynchronous message passing between different nodes in a robotic system. Publishers send messages to topics, and subscribers receive messages from topics without needing to know about each other directly."}),"\n",(0,i.jsx)(s.h2,{id:"understanding-topics",children:"Understanding Topics"}),"\n",(0,i.jsx)(s.p,{children:"In ROS 2, a topic is a named bus over which nodes exchange messages. Topics have a type associated with them, which defines the structure of the messages that can be published to that topic. Nodes can publish messages to a topic or subscribe to a topic to receive messages."}),"\n",(0,i.jsx)(s.h2,{id:"creating-a-publisher-node",children:"Creating a Publisher Node"}),"\n",(0,i.jsxs)(s.p,{children:["Let's create a simple publisher node that publishes messages to a topic called ",(0,i.jsx)(s.code,{children:"example_topic"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"python-publisher-example",children:"Python Publisher Example"}),"\n",(0,i.jsx)(s.p,{children:"First, let's create a new ROS 2 package for our examples:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# In your workspace directory (~/ros2_ws)\nmkdir -p src/py_pubsub\ncd src/py_pubsub\nros2 pkg create --build-type ament_python py_pubsub\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Now create the publisher script at ",(0,i.jsx)(s.code,{children:"src/py_pubsub/py_pubsub/publisher_member_function.py"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\n\nclass MinimalPublisher(Node):\n\n    def __init__(self):\n        super().__init__('minimal_publisher')\n        self.publisher_ = self.create_publisher(String, 'example_topic', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = f'Hello World: {self.i}'\n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Publishing: \"{msg.data}\"')\n        self.i += 1\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_publisher = MinimalPublisher()\n\n    rclpy.spin(minimal_publisher)\n\n    # Destroy the node explicitly\n    minimal_publisher.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(s.h3,{id:"c-publisher-example",children:"C++ Publisher Example"}),"\n",(0,i.jsxs)(s.p,{children:["For C++ users, create a similar publisher at ",(0,i.jsx)(s.code,{children:"src/cpp_pubsub/src/talker.cpp"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-cpp",children:'#include <chrono>\n#include <cinttypes>\n#include <memory>\n#include <string>\n\n#include "rclcpp/rclcpp.hpp"\n#include "std_msgs/msg/string.hpp"\n\nusing namespace std::chrono_literals;\n\nclass MinimalPublisher : public rclcpp::Node\n{\npublic:\n  MinimalPublisher()\n  : Node("minimal_publisher"), count_(0)\n  {\n    publisher_ = this->create_publisher<std_msgs::msg::String>("example_topic", 10);\n    timer_ = this->create_wall_timer(\n      500ms, std::bind(&MinimalPublisher::timer_callback, this));\n  }\n\nprivate:\n  void timer_callback()\n  {\n    auto message = std_msgs::msg::String();\n    message.data = "Hello World: " + std::to_string(count_++);\n    RCLCPP_INFO(this->get_logger(), "Publishing: \'%s\'", message.data.c_str());\n    publisher_->publish(message);\n  }\n  rclpp::TimerBase::SharedPtr timer_;\n  rclcpp::Publisher<std_msgs::msg::String>::SharedPtr publisher_;\n  size_t count_;\n};\n\nint main(int argc, char * argv[])\n{\n  rclcpp::init(argc, argv);\n  rclcpp::spin(std::make_shared<MinimalPublisher>());\n  rclcpp::shutdown();\n  return 0;\n}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"creating-a-subscriber-node",children:"Creating a Subscriber Node"}),"\n",(0,i.jsx)(s.p,{children:"Now let's create a subscriber node that listens to the same topic."}),"\n",(0,i.jsx)(s.h3,{id:"python-subscriber-example",children:"Python Subscriber Example"}),"\n",(0,i.jsxs)(s.p,{children:["Create the subscriber at ",(0,i.jsx)(s.code,{children:"src/py_pubsub/py_pubsub/subscriber_member_function.py"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\n\nclass MinimalSubscriber(Node):\n\n    def __init__(self):\n        super().__init__('minimal_subscriber')\n        self.subscription = self.create_subscription(\n            String,\n            'example_topic',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_subscriber = MinimalSubscriber()\n\n    rclpy.spin(minimal_subscriber)\n\n    # Destroy the node explicitly\n    minimal_subscriber.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(s.h2,{id:"running-the-publisher-and-subscriber",children:"Running the Publisher and Subscriber"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"First, build your workspace:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select py_pubsub\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:"Source the workspace:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsx)(s.li,{children:"Run the publisher in one terminal:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ros2 run py_pubsub publisher_member_function\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"4",children:["\n",(0,i.jsx)(s.li,{children:"In another terminal, run the subscriber:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ros2 run py_pubsub subscriber_member_function\n"})}),"\n",(0,i.jsx)(s.p,{children:"You should see the publisher sending messages and the subscriber receiving them."}),"\n",(0,i.jsx)(s.h2,{id:"understanding-the-code",children:"Understanding the Code"}),"\n",(0,i.jsx)(s.h3,{id:"publisher-breakdown",children:"Publisher Breakdown"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"self.create_publisher(String, 'example_topic', 10)"}),": Creates a publisher that sends ",(0,i.jsx)(s.code,{children:"String"})," messages to the topic ",(0,i.jsx)(s.code,{children:"example_topic"}),". The last parameter (10) is the queue size for outgoing messages."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"self.create_timer(timer_period, self.timer_callback)"}),": Creates a timer that calls ",(0,i.jsx)(s.code,{children:"timer_callback"})," every 0.5 seconds."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"self.publisher_.publish(msg)"}),": Publishes the message to the topic."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"subscriber-breakdown",children:"Subscriber Breakdown"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"self.create_subscription(String, 'example_topic', self.listener_callback, 10)"}),": Creates a subscription to the ",(0,i.jsx)(s.code,{children:"example_topic"})," that expects ",(0,i.jsx)(s.code,{children:"String"})," messages. When a message is received, ",(0,i.jsx)(s.code,{children:"listener_callback"})," is called."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"self.listener_callback(msg)"}),": This function is called whenever a message is received on the topic."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"message-types",children:"Message Types"}),"\n",(0,i.jsxs)(s.p,{children:["ROS 2 comes with many built-in message types in packages like ",(0,i.jsx)(s.code,{children:"std_msgs"}),", ",(0,i.jsx)(s.code,{children:"geometry_msgs"}),", ",(0,i.jsx)(s.code,{children:"sensor_msgs"}),", etc. You can also define your own message types. Some common message types include:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"std_msgs/String"}),": Simple string message"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"std_msgs/Int32"}),": 32-bit integer"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"std_msgs/Float64"}),": 64-bit floating point"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"geometry_msgs/Twist"}),": For velocity commands"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"sensor_msgs/LaserScan"}),": For laser scanner data"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,i.jsx)(s.p,{children:"When creating publishers and subscribers, you can specify Quality of Service (QoS) settings that control how messages are delivered. These settings affect reliability, durability, and other aspects of message delivery."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"from rclpy.qos import QoSProfile\n\n# Create a QoS profile with specific settings\nqos_profile = QoSProfile(depth=10)\n# You can also specify reliability, durability, etc.\n"})}),"\n",(0,i.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Use descriptive topic names"}),": Choose clear, consistent names that indicate the purpose of the topic."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Handle exceptions"}),": Always consider what happens if a node crashes or loses connection."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Match message types"}),": Ensure that publishers and subscribers use the same message types."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Use appropriate QoS settings"}),": Consider the requirements of your application when choosing QoS settings."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(s.p,{children:"The publisher-subscriber pattern is essential for ROS 2 communication. It enables decoupled, asynchronous communication between nodes in a robotic system. By creating publishers and subscribers, you can build complex systems where different components communicate through well-defined interfaces."}),"\n",(0,i.jsx)(s.p,{children:"In the next section, we'll explore services, which provide a request-response communication pattern that complements the pub/sub model."})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);