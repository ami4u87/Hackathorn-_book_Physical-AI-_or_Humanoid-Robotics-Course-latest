# Workflow optimized for local testing with act
# Usage: act -j quick-test

name: Quick Test (act compatible)

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  quick-test:
    runs-on: ubuntu-22.04
    timeout-minutes: 30

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build Docker image
        run: |
          docker build -f Dockerfile.ros2-humble-gazebo -t ros2-test:latest .

      - name: Run quick build
        run: |
          docker run --rm \
            -v ${{ github.workspace }}:/workspace/src/project \
            -w /workspace \
            ros2-test:latest \
            bash -c "
              source /opt/ros/humble/setup.bash
              colcon build --symlink-install
            "

      - name: Run unit tests only
        run: |
          docker run --rm \
            -v ${{ github.workspace }}:/workspace/src/project \
            -w /workspace \
            ros2-test:latest \
            bash -c "
              source /opt/ros/humble/setup.bash
              source install/setup.bash
              colcon test --packages-select-test-failures
              colcon test-result --all
            "
